\documentclass[aps,twocolumn]{revtex4}

% Maths
\usepackage{bm}
\usepackage{amsmath}

% Text
\usepackage{siunitx}

% Figures
\usepackage{graphicx}
\usepackage{subfig}

% Referencing
\usepackage{cleveref}
\newcommand{\ccite}[1]{ref.~\cite{#1}}
\newcommand{\Ccite}[1]{Ref.~\cite{#1}}
\newcommand{\ccites}[1]{refs.~\cite{#1}}
\newcommand{\Ccites}[1]{Refs.~\cite{#1}}

% Temp
\usepackage{lipsum}
\usepackage{xcolor}
\newcommand{\temp}[1]{\textcolor{red}{#1}}



\begin{document}
\title{Efficient saddle point search - Binary image transistion state search}
\author{Sam Avis}
\author{Jack Panter}
\author{Halim Kusumaatmaja}

\begin{abstract}
\lipsum[1]
\end{abstract}

\maketitle


\section{Introduction}
Historically, the development of computational methods to locate transition states in free or potential energy landscapes has had significant impact in particulate and atomistic systems. In these, the energy barrier between a local energy minimum and a transition state informs the probability of the transition occurring within a thermalised population, and ultimately reaction rates and kinetics. However, it is increasingly being recognised that transition states are useful in mesoscale or macroscale systems, in which the energy barriers are sufficiently high that thermal transition probabilities are vanishingly small. Instead, the minimum energy barriers provide important lower bounds to the energy input required for transitions to occur.

This is essential to capture in, for example, structural engineering applications, where the minimum energy mechanism for structural failure must be known in order to ensure safety. Moreover, it is becoming desirable to functionalise elastic deformation transition mechanisms to enable technologies such as advanced 3D manufacturing techniques, mechanical sensors and actuators, and energy harvesting to name but a few. A second mesoscale area benefitting from a description of transition states is in multi-fluidic and wetting applications. For example, a knowledge of the minimum energy failure mechanisms on super liquid-repellent surfaces informs design criteria in order to optimise device performance. Finally, transition mechanisms are important in robotics, for locomotion and navigation of rigid bodies through complex terrain [Othayoth, R., Thoms, G., \& Li, C. (2020). An energy landscape approach to locomotor transitions in complex 3D terrain. Proceedings of the National Academy of Sciences, 117(26), 201918297. https://doi.org/10.1073/pnas.1918297117].

These meso- and macroscale potential energy landscapes exhibit a range of features not typically observed in atomistic systems, which makes traditional landscape techniques inefficient or inapplicable. For example, discretisations of 3D continuum systems can posses extremely large numbers of degrees of freedom. As a result, double-ended methods involving a chain of tens of states can become computationally expensive, or even prohibitive. The issue is compounded by systems with long, non-linear pathways, or sudden structural changes near the transition state, because these require an even larger number of states to accurately approximate the transition state. Here, we introduce a new method for identifying transition states to address these and other issues relevant to meso- and macroscale applications. The method, dubbed the Binary Image Transition State Search (BITSS), involves the convergence of only two states from minima to an intermediate transition state, hence it has the potential to be significantly faster than existing chain-of-states approaches.

We highlight five key differences:

(1) Long pathways and sudden structural changes at the TS. Pretty much all previous methods (both single and double-ended) are terrible if the MEP changes abruptly in the vicinity of the TS. I had big problems with locating the TS in bifluidic systems on complex structures surfaces for example, because there is an abrupt structural change, and the energy is quite sharply peaked at the TS. This meant the image density of double ended methods had to be very high in order to get close enough to the TS for a single-ended method to work (if indeed it ever did work). BITSS is particularly good if you have long pathways, or if the TS is located in only a very small region of configuration space.

I have some notion that this is due to the ‘locality’ of the transition – LJ transitions for example tend to be very local, (i.e. most particles are ~fixed except for a small number changing location) but in wetting and elastic transitions, often many of the degrees of freedom are changing collectively. This is purely my intuition, but I would like to know why the string method and DNEB are bad for elastic / wetting systems.

(2) Large numbers of degrees of freedom. For double-ended search methods, there are $\sim10$s of images in the chain of states. This makes such techniques computationally expensive, or even prohibitive, for example in 3D discretisation of continuum systems, for anything above $\sim10^6$ degrees of freedom (per processor if parallelised)

(3) Zero eigenmodes. Interaction potentials in meso or macroscale systems are typically short range, and often limited to contact forces. Thus, there may be many regions in the potential energy landscape that are locally flat. In atomistic systems, single ended search methods require specialist treatment to deal with the most common of these zero modes, such as global translation and

rotation in free space. These require analytic expressions for the translation and rotation vectors, which are known. However, these single-ended search methods are thwarted by local zero modes.

(4) Undefined gradients. The energy landscapes may be discontinuous, prevalent for example in systems of solid bodies in which overlap incurs an infinite (or undefined) energetic penalty. Alternatively, the potential energy gradients may be prohibitively expensive to compute, or not available. In both cases, typical landscapes methods that require continuous, differentiable (often twice-differentiable) optimisation functions will not be appropriate.

(5) Adaptive discretisation. In many mesocale and macroscale simulations, a strategy to reduce the computational overheads is to have a coarse-grained description of the system in regions with few changing features, and increase in resolution in regions of interest. This is performed adaptively, and the number of degrees of freedom change (which typical landscape methods can’t cope with easily)

In the paper, we then systematically show how BITSS can deal with these. A further advantage of BITSS is we get the ‘reactive’ eigenvector and eigenvalue information for free.

\begin{center}
\rule{3cm}{0.2pt}
\end{center}

The identification of transition states is an important problem for the characterisation of multistable systems. In particular, it is widely used to determine reaction rates of chemical processes. There has also been recent interest in applying these methods to mechanical and soft-matter systems to determine energy barriers and transition pathways. Examples include buckling \cite{Panter2019,Hutchinson2018}, lipid vesicles and liquid crystals \cite{Kusumaatmaja2015}, wetting \cite{Panter2019b,Zhang2014}, and locomotion \cite{Othayoth2020}.

Problem - Very large numbers of degrees of freedom - existing methods are slow.
Many of these are continuous systems which must be modelled by a large number of degrees of freedom. Consequently, the speed of the algorithm is of high importance for these applications.
Also - some systems have complex and non-linear pathways which makes it difficult to use existing methods which require an initial pathway estimation.

Transition state search methods fall into two categories, single- and double-ended methods.
Single-ended methods are initialised at a single state, typically a minimum in the potential energy landscape, and attempt to identify nearby saddle points. These methods can converge quickly, although are not well suited to identifying specific pathways because a single minimum can be surrounded by many saddle points. Examples include eigenvector following \cite{Cerjan1981}, the dimer method \cite{Heyden2005,Kastner2008}, and climbing image methods \cite{E2007,Ren2013}.
Current double-ended methods, such as the string method \cite{E2002,E2007} and doubly-nudged elastic band (DNEB) \cite{Trygubenko2004}, involve initialising a chain of states between two minima and then minimising the total energy of the chain. These methods are useful for obtaining an estimate for the full transition pathway, but are slow to converge because they typically use tens of states. In addition, these methods are often insufficient at accurately finding the transition states and therefore must be used in conjunction with a single-ended search.

We introduce a new double-ended method, dubbed the binary image transition state search (BITSS). This involves the convergence of only two states from minima to an intermediate transition state, hence it has the potential to be significantly faster than the existing chain-of-states approaches. This method also depends only upon the initial two states and does not require an initial guess for the pathway. Furthermore, because the two states converge accurately to the transition state a secondary method is not necessary.

In this paper we compare the rate of convergence of this method against existing double-ended methods to test if it is indeed faster.
We also highlight additional advantages of this method, including the ability to use differing discretisations or gradient-free minimisation.
Finally, we show how the BITSS method can be utilised to find pathways with multiple saddle points and to survey full energy landscapes of systems.


\section{Method}
The method begins with two initial states, $\bm{x}_1$ and $\bm{x}_2$. These are typically minima on the energy landscape, but this is not required. The energy of this pair of states is then minimised subject to two constraints. Firstly, there is a prescribed separation between the two states which is reduced over time so that they converge. The second constraint requires the two energies to be equal. This ensures that the two states remain in different basins of attraction by preventing either state from passing over the dividing ridge. Consequently, they will meet at either side of a saddle point on the ridge, with the transition state midway between the two. Furthermore, this final state can also be used to obtain the negative curvature eigenvector and eigenvalue for free.

The two constraints are implemented using quadratic energy penalty terms, resulting in the following potential for the pair of states,
\begin{multline}
  V_\text{BITSS}(\bm{x}_1, \bm{x}_2) = E_1 + E_2
    + \kappa_e \left( E_1 - E_2 \right) ^2 \\
    + \kappa_d \left( \mathrm{d}(\bm{x}_1, \bm{x}_2) - d_0 \right) ^2,
  \label{eq:bitss}
\end{multline}
where $E_1$ and $E_2$ are the single state energies, $\mathrm{d}(\ast, \ast)$ is the measure of distance between the two states, and $d_0$ is the target distance. \Cref{fig:toy2d} demonstrates the driving forces resulting from each of these energy penalty terms for a 2D potential. The method is performed iteratively, first minimising \cref{eq:bitss} for a constant separation $d_0$, then reducing $d_0$ and repeating. Here we use the L-BFGS algorithm for the minimisation, owing to its fast convergence and low memory requirement for large numbers of degrees of freedom \cite{Liu1989}. When the separation between the states is low it is possible for a state to jumping over the saddle point. Therefore, the amount $d_0$ is reduced should shrink in proportion to $d_0$ to prevent this. Halving it each iteration is successful for most applications.

The coefficients for the constraints, $\kappa_d$ and $\kappa_e$, must be assigned carefully. If they are too small one state may pass over the ridge and converge at a minimum, or they may not converge at all, and if they are too large they can screen out the single state potentials. Furthermore, as the separation decreases these coefficients will have to change.
To solve these issues the coefficient assignment is automated. They are calculated at the start and regularly throughout each minimisation; once per 100 iterations are used in this work. The coefficients are chosen such that each term in the gradient of \cref{eq:bitss} is of a similar size, providing the following expressions,
\begin{gather}
  \kappa_e = \frac {\alpha} {2 \Delta E},
  \label{eq:ke}
  \\
  \kappa_d = \text{max} \left(
    \frac {\sqrt{|\bm{\nabla} E_1|^2 + |\bm{\nabla} E_2|^2}} {2\sqrt{2} \beta d_0} \ , \ 
    \frac{\Delta E}{\beta d_0^2} \right),
  \label{eq:kd}
\end{gather}
where $\alpha$ and $\beta$ are parameters with recommended values of $\alpha = 10$ and $\beta = 0.1$ (see supplementary information). $\Delta E$ is an estimation for the current energy barrier which is evaluated by linearly interpolating between the two current states. For systems where the interpolation deviates significantly from the MEP this estimate can be much too large. In which case, a maximum value for the barrier can be provided which then decreases proportionally with $d_0$.

\begin{figure}[htb]
  \centering
  \includegraphics{fig/toy2d.pdf}
  \caption{
    (a) A schematic showing a snapshot of the BITSS minimisation with the driving forces on each state due to the energy constraint, $\bm{F}_E$, and distance constraint, $\bm{F}_D$.
    (b) A schematic of the final configuration of the BITSS method. Showing the two states in red, the transition state approximation in orange, and the direction of negative curvature, $\bm{\hat{\tau}}$, that passes through the two states. 
    (c) A simple 2D potential with 2 minima (blue) and an intermediate transition state (orange). The trajectories of the two states using the BITSS method are shown in red and the minimum energy pathway is the dashed magenta line.}
  \label{fig:toy2d}
\end{figure}

Once BITSS has identified the transition state it is possible to find the full minimum energy pathway (MEP), which is the path between the two minima passing through the transition state while following the gradient.
This is done by tracing the trajectory of downhill minimisations either side of the transition state, which are provided by the two final states of BITSS. The maximum step size of the minimisation should be restricted to ensure a sufficiently smooth pathway.

As an illustrative example, the BITSS method is applied to a simple 2D potential, as shown in \cref{fig:toy2d}c.
We can see that the trajectory taken by BITSS does not match the MEP. Instead, one state initially jumps up to match the energy of the other. Then when the states cannot get closer without increasing their energy they begin moving directly towards each other as a result of the decreasing separation constraint. Once they get closer the potential wells are distorted by the saddle and so the states are deflected towards it.
Consequently, if there were multiple pathways between the two states, BITSS would be biased towards identifying pathways that are more direct or with lower energy.


\section{Speed Comparison}
\begin{figure*}[htb]
  \centering
  \includegraphics{fig/speedtest-a.pdf}%
  \includegraphics{fig/speedtest-b.pdf}%
  \includegraphics{fig/speedtest-c.pdf}%
  \caption{The rate of convergence to the transition state for (a) a Lennard-Jones seven-particle cluster, (b) cylindrical shell buckling, (c) wetting of a chemically-striped surface. Above are the two minimum energy states and the transition state between them. Below is shown the convergence to the transition state as a function of the number of gradient calculations using the BITSS (black line) and string methods. The string method is repeated with a differing number of images along the string, the number of which is listed in the legend in (c).}
  \label{fig:speedtest}
\end{figure*}

As a result of the BITSS method using only two states it has the potential to be significantly faster than chain-of-states approaches which typically use tens of states. This is tested here by comparing the speeds at which the BITSS and string methods converge to the transition state for several examples. The accuracy of the BITSS method is calculated using the distance between the correct transition state and the average of the two states. While for the string method, the accuracy is measured as the distance of the transition state from a cubic spline interpolation of the points along the string. For each method, the accuracy is measured against the number of times the energy and gradient of the system are evaluated.

The first system to be tested is a two-dimensional seven-particle cluster with Lennard-Jones interactions. The transition begins with the hexagonal cluster and involves the movement of two particles to reach a higher energy configuration.

The second system is an elastic cylindrical shell under an applied strain. This undergoes a transition from an unbuckled state to a singly-dimpled state, which is significant because it defines the minimum energy required for the cylinder to buckle \cite{Panter2019}. To model the surface a two-dimensional triangular mesh is used. The energy of the surface is calculated by considering the stretching energies of bonds and the bending energies for pairs of triangular faces. Following the approach used in \ccite{Panter2019}, the geometry of the mesh is considered when calculating the rigidities of each element to ensure that the continuum elastic properties are accurately modelled.

The final system involves a droplet situated on a chemically striped surface with both hydrophilic and hydrophobic regions. This has two possible states, with the droplet either upon one hydrophilic stripe, or straddling across two. This is modelled on a 200x200 2D grid using a phase-field model as outlined in \ccite{Panter2019b}. This uses an order parameter field to distinguish between the liquid and gas, resulting in a diffuse interface, and uses a fixed volume constraint for the droplet. The contact angles of the hydrophilic and hydrophobic regions are 60\si{\degree} and 110\si{\degree} respectively.

The results for this test, shown in \cref{fig:speedtest}, demonstrate two main advantages for the BITSS method. Firstly, the slope illustrates that the rate of convergence is indeed much greater for the BITSS method. It is matched only by the initial rate of the string method with five to ten images, however these soon slow and are relatively inaccurate. Secondly, the BITSS method can more accurately approximate the transition state by orders of magnitude, particularly for the wetting example, where the string method does not significantly improve upon the initial pathway estimate. Therefore, unlike the string method, BITSS does not require a second approach to accurately locate the transition state. Similar results are also found when comparing against against DNEB, which can be seen in the supplementary information.

\section{Different grid resolutions}
\begin{itemize}
\item
Adaptive grid models are used for many problems. However, this can introduce issues for double-ended search methods because the different states are on different meshes and they can change over the course of the algorithm.
To test how BITSS can be applied to these models we investigate each of these problems individually.
\item
First, we test the effect of changing a mesh which is shared by the two states.
For this we use the cylindrical buckling example and refine the mesh as it approaches the transition state.
This is successful without any special considerations, as shown in \cref{fig:differentgrids}a.
\item
For the second test we investigate how BITSS performs when the two states use different meshes.
We need to make sure that the distance measure takes into account the different grids.
The most straightforward approach - interpolate onto the same grid and compute the Euclidean distance.
Simpler distance measures may be sufficient for some applications, such as the difference between average values of the system.
\item
Demonstration: wetting on striped surface, one state using a resolution of 200x200, and 400x400 for the other. The result is shown in \cref{fig:differentgrids}b.
\item
In this case there is a limit to how close the states can get. This is because the energy of the transition state is slightly different on each grid, and so eventually the equal energy constraint will fail. This effect will be more pronounced at low resolutions. However, as shown in \cref{fig:differentgrids}b, we are able to get an accurate approximation without having to resorting to high resolutions. Furthermore, if we use an adaptive grid model the grids should converge as the states do, thereby eliminating the issue.
\end{itemize}

\begin{figure}[htb]
  \centering
  \begin{tabular}[b]{c}
    \includegraphics{fig/changingmesh.pdf}\\
    \includegraphics{fig/differentgrids-a.pdf}%
    \includegraphics{fig/differentgrids-b.pdf}%
  \end{tabular}
  \caption{
  (a) Snapshots of the BITSS method applied to the buckling of a cylinder with a changing mesh. The radial displacement relative the unbuckled cylinder is shown, as well as the underlying triangular mesh.
  (b) The final two states after applying the BITSS method to wetting on a striped surface using a pair of different grid resolutions. Each grid cell denotes 50x50 lattice nodes. The black sections of the substrate are hydrophilic (60\si{\degree} contact angle), while the white are hydrophobic (110\si{\degree}). The right axes shows the interface of the approximated transition state with a single resolution of 200 or 400, and for a mixed resolution. The inset shows a closer view of the location with the largest discrepancy.}
  \label{fig:differentgrids}
\end{figure}


\section{Zero-curvature modes}
Problems can arise for some methods when there are zero-curvature or zero-gradient modes. This is particularly true for those that rely solely upon local information, such as many single-ended methods. Sometimes it is possible to remove these modes, such as fixing global rotation, but in many cases it can be much more difficult.

In \cref{fig:flatdiscontinuous}a we demonstrate that BITSS is able to successfully converge when there are flat regions (i \& ii), even with one that is very close to the transition state (ii). In these regions there are no driving forces due to the potential and the energy constraint, because these use purely local information about the gradient. However, the distance constraint continues to pull the states together, preventing them from getting stuck. When only a single state has a zero-gradient mode then the other is likely to slide down the potential slightly, causing a kink in the pathway (iii). Although, this would not affect the result because the two states still remain either side of the dividing ridge. Indeed, only if the zero-gradient mode is at the transition state in the direction of the pathway will it cause BITSS to fail. But in this case there is no single transition state, instead the MEP would have a flat section at the top of its energy profile. 


\begin{figure}[htb]
  \centering
  \begin{tabular}[b]{c}
    \includegraphics{fig/zeroeigen.pdf}\\
    \includegraphics{fig/discontinuous.pdf}
  \end{tabular}
  \caption{(a) Energy profile of the BITSS pathway on a 2D potential with flat regions. The minima and transition state are marked by red and magenta dots respectively. Points of interest are labelled by i-iii. Top inset: A zoomed in view around the transition state. Bottom inset: The pathway taken, with the edges of the flat regions marked by dashed lines. (b) Disconnectivity graph of the energy landscape for a seven-particle cluster with a discontinuous hard-core pair potential (shown in inset).}
  \label{fig:flatdiscontinuous}
\end{figure}


\section{Gradient-free problems}
\begin{itemize}
\item
BITSS can also be adapted to be a gradient-free method.
Useful because in many problems the gradient is either infeasible to calculate or undefined.
\item
Two adjustments are necessary, a gradient-free minimiser instead of L-BFGS, and ignoring the term in \cref{eq:kd} that uses the gradient information.
\item
Simulated annealing can be used for the minimiser for each step of the BITSS method.
To reduce the probability of the states jumping over the barrier the initial temperature is set to $T_0 = \frac{\Delta E}{10}$, and the maximum size of random displacements to $d_\text{max} = d(\bm{x}_1, \bm{x}_2) / 100$.
Each minimisation is stopped after 1000 consecutive rejections or 10000 total iterations.
\item
Tested using a Lennard-Jones 7-particle cluster with hard cores, for which the gradient is not defined when the particles overlap.
The gradient-free method is able to successfully find the transition states, allowing us to plot the disconnectivity graph of the system, as shown in \cref{fig:flatdiscontinuous}b.
\item
Notably, this takes much longer than gradient-based approaches, which are preferable if possible.
\end{itemize}


\section{Conclusion}
\begin{itemize}
\item
Low memory
\item
Fast
\item
Can accurately find TS without 2nd method
\item
Does not require an initial path estimation
\item
Can be used with states on different grids
\item
Can be used for gradient-free location of transition state
\end{itemize}


\bibliographystyle{plain}
\bibliography{../../library.bib}

\end{document}