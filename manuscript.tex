\documentclass[aps,prl,twocolumn,10pt,groupedaddress]{revtex4-2}

% Maths
\usepackage{bm}
\usepackage{amsmath}

% Text
\usepackage{siunitx}

% Figures
\usepackage{graphicx}

% Referencing
\usepackage{cleveref}
\Crefname{figure}{Fig.}{Figs.}

% Temp
\newcommand*{\newlinecommand}[2]{%
  \newcommand*{#1}{%
    \begingroup%
    \escapechar=`\\%
    \catcode\endlinechar=\active%
    \csname\string#1\endcsname%
  }%
  \begingroup%
  \escapechar=`\\%
  \lccode`\~=\endlinechar%
  \lowercase{%
    \expandafter\endgroup
    \expandafter\def\csname\string#1\endcsname##1~%
  }{\endgroup#2\space}%
}
\newlinecommand{\topic}{\textbf{#1}}
% \newlinecommand{\topic}{#1}


\begin{document}
\title{Locating saddle points in complex and memory intensive landscapes}
\title{Binary Image Transition State Search Method}
\author{Samuel J. Avis}
\author{Jack R. Panter}
\email[]{j.r.panter@durham.ac.uk}
\author{Halim Kusumaatmaja}
\email[]{halim.kusumaatmaja@durham.ac.uk}
\affiliation{Department of Physics, Durham University, South Road, Durham DH1 3LE, UK}

\begin{abstract}
  Locating transition states is crucial for investigating transition mechanisms in wide-ranging atomistic systems and, more recently, macroscale systems.
  Existing methods, however, can struggle in problems with a large number of degrees of freedom, on-the-fly adaptive remeshing and coarse-graining, and energy landscapes that are locally flat or discontinuous.
  To resolve these challenges, we introduce a new double-ended method, the Binary Image Transition State Search (BITSS).
  It uses just two states that converge to the transition state, resulting in a flexible, fast, and memory-efficient method.
  We demonstate its versatility by applying BITSS to three very different classes of problems: Lennard-Jones clusters, shell buckling, and multiphase phase-field models.
\end{abstract}

\maketitle


%\section{Introduction \& Method}
\topic Transition states are central to the description of reconfiguration mechanisms for systems in chemistry, condensed matter physics, and engineering.
Historically, many computational methods for locating transition states have grown from an atomistic or particulate perspective.
These have proven to be important tools for understanding, for example, protein folding \cite{Bryngelson1995,Onuchic1997}, biological and industrial catalysis \cite{Boehr2006,Kerns2015,Guo2018a}, quantum tunneling \cite{Richardson2016,Vaillant2019}, crystallisation, and cluster formation \cite{Wales1998,Wales2012}.

\topic More recently, it is increasingly being recognised that transition states are useful in mesoscale or macroscale systems.
Here, the minimum energy barriers provide important lower bounds to the energy input required for transitions to occur.
This has been used to understand failure in structural engineering applications \cite{Panter2019,Hutchinson2018}, for the development of super liquid-repellent surfaces \cite{Zhang2014,Panter2019b}, and investigating locomotion through complex terrain for robotics \cite{Othayoth2020}.
Moreover, it is becoming desirable to tailor elastic deformation transitions to enable technologies such as advanced deployable structures \cite{Filipov2015,Zhai2018}, mechanical sensors and actuators, and energy absorption \cite{Shan2015} to name but a few.

\topic Existing transition state search methods generally fall into two categories, single- and double-ended methods.
Single-ended methods are initialised at a single state and attempt to climb to a nearby saddle point.
Examples include eigenvector following \cite{Cerjan1981}, the dimer method \cite{Heyden2005,Kastner2008}, and climbing image methods \cite{E2007,Ren2013}.
Double-ended methods, such as the string method \cite{E2002,E2007} and doubly-nudged elastic band (DNEB) \cite{Trygubenko2004}, involve initialising a chain of states between two minima and then minimising the total energy of the chain.
In addition to approximating the transition state, these are useful for obtaining an estimate for the full transition pathway.

\topic However, a large range of landscapes prove challenging or impossible to explore via these methods.
One key problem arises from the push towards larger and more complex systems \cite{Trefethen2013,Shalf2020,Alexander2020}, resulting in the need to develop algorithms that are more memory and computationally efficient, and can incorporate optimisation strategies such as on-the-fly adaptive remeshing and coarse-graining.
Current double-ended methods require a chain of tens of states to gain an accurate approximation, and have issues with remeshing resulting in a different discretisation for each state.
Single-ended methods are not well suited for identifying specific pathways and can spend a large amount of time searching for undesired transition states.
Another major challenge in studying complex energy landscapes relates to the presence of locally flat or discontinous regions.
Both of which can be relevent when considering contact forces for macroscopic objects [cite], or hard-body interactions in atomistic systems [cite].
Flat zero-modes in the landscape pose issues for single-ended search methods that rely only upon local information.
Specialist treatment can sometimes be used such as in the case of global rotation and translation \cite{Page1988}, but they are thwarted by local zero-modes.
Meanwhile, current methods cannot typically be applied in the case of discontinuous potentials, or where the gradient is prohibitively expensive to compute, because they require continuous, differentiable optimisation functions.

\begin{figure}[htb]
  \includegraphics{fig/toy2d.pdf}
  \caption{\label{fig:toy2d}
    (a) The trajectories of the two states under the BITSS method for a simple 2D potential with two minima (blue dots).
        The transition state is shown by an red dot, and the minimum energy pathway by the dashed line.
    (b) A snapshot of the BITSS minimisation showing the driving forces on each state due to the energy constraint, $\bm{F}_E$, and distance constraint, $\bm{F}_D$, with $E_1 < E_2$ and $\mathrm{d}(\bm{x}_1,\bm{x}_2) < d_i$.
    (c) The final configuration of the BITSS method showing the two states in orange, the transition state in red, and the negative curvature eigenvector, $\bm{\hat{\tau}}$.
  }
\end{figure}

\topic In this work we introduce a new method, the Binary Image Transition State Search (BITSS).
This is a double-ended method that uses two states that converge toward a transition state from either side, therefore combining aspects of the two traditional transition state search categories.
We will demonstrate how it addresses each of the above challenges using a range of different applications.


%\section{Method}
\topic The method begins by first initialising the states, $\bm{x}_1$ and $\bm{x}_2$, in the basins of attraction of different local minima.
These can be set to the minima, but this is not a necessary requirement.
The BITSS method then causes these states to meet at the lowest point on the ridge between the basins of attraction - the transision state.
This is done by minimising the energy of the pair while constraining their separation.
The separation $d_i$ is incrementally reduced, such that at iteration $i$,
\begin{equation}\label{eq:diteration}
  d_i = (1 - f) d_{i-1},
\end{equation}
with $d_0$ as the separation between the initial states.
A factor of $f = 0.5$ is succesful for most applications, but this can be made smaller to ensure that the states do not slide off the ridge.
A secondary constraint that sets the energies of the two states equal is also used to ensure that neither state is pulled over the ridge.

\topic Using this approach, the typical trajectories of the states are demonstrated for a simple 2D potential in \cref{fig:toy2d}a.
Initially, the lower energy state jumps up to satisfy the equal energy constraint and then moves to minimise the separation without increasing its energy.
Then, the two states converge directly towards one another, before being deflected towards the saddle in the ridge.
Consequently, if there are multiple possible pathways between two states, BITSS will be biased towards identifying those that are more direct or with lower energy.
Furthermore, the final two states are positioned either side of the transition state in the direction of the negative curvature eigenvector, $\bm{\hat{\tau}}$ (\cref{fig:toy2d}c).
So, BITSS automatically identifies the `reactive mode' and associated eigenvalue in addition to the transition state.

\topic The two constraints are implemented using energy penalty terms, which, if the constraints are not met, result in driving forces on the two states, such as in \cref{fig:toy2d}b.
The total energy of the pair of states is therefore given by,
\begin{multline}\label{eq:bitss}
  E_\text{BITSS}(\bm{x}_1, \bm{x}_2) = E_1 + E_2
    + \kappa_e \left( E_1 - E_2 \right) ^2 \\
    + \kappa_d \left( \mathrm{d}(\bm{x}_1, \bm{x}_2) - d_i \right) ^2,
\end{multline}
where $E_1$ and $E_2$ are the single state energies, $\kappa_e$ and $\kappa_d$ parametrise the strengths of the energy and distance constraints, and $\mathrm{d}(\bm{x}_1, \bm{x}_2)$ is the measure of distance between the two states.
In this work the L-BFGS algorithm is chosen to minimise the energy, owing to its fast convergence and low memory requirement for large numbers of degrees of freedom \cite{Liu1989}.
However, any other minimisation method can be used instead.

\topic To ensure that the transition state is located successfully, the constraint strengths $\kappa_d$ and $\kappa_e$ are updated as the algorithm proceeds using information from the system.
They are initially calculated at the start of each minimisation, and regularly recalculated throughout (once per 100 iterations are used in this work).
They are set using the following equations such that each term in the gradient of \cref{eq:bitss} is of a similar size,
\begin{gather}
  \kappa_e = \frac {\alpha} {2 \Delta E},
  \label{eq:ke}
  \\
  \kappa_d = \max \left(
    \frac {\sqrt{|\bm{\nabla} E_1|^2 + |\bm{\nabla} E_2|^2}} {2\sqrt{2} \beta d_i} \; , \;
    \frac{\Delta E}{\beta d_i^2} \right),
  \label{eq:kd}
\end{gather}
where $\alpha$ and $\beta$ are parameters with recommended values of $\alpha = 10$ and $\beta = 0.1$ (see supplementary information).
Here, $\Delta E$ is an estimation for the current energy barrier evaluated by linearly interpolating between the two states.
For systems where the interpolation deviates significantly from the pathway the estimate can be too large.
In which case, a maximum estimated value can be provided, which then decreases proportionally with $d_i$.

\topic In summary, the method involves iteratively performing the following three steps:
\begin{enumerate}
  \item Reduce the target separation using \cref{eq:diteration}.
  \item Compute the constraint coefficients using \cref{eq:ke,eq:kd}.
  \item Minimise the potential, \cref{eq:bitss}, and recompute the coefficients every 100 iterations of the minimisation.
\end{enumerate}
This process is completed once a convergence criterion is reached that can be based upon either the separation between the states, or the size of gradient at the midpoint between the two states.

\topic Once BITSS has identified the transition state it is possible to find the full minimum energy pathway.
This is done by tracing the trajectory of downhill minimisations from the two final states either side of the transition state.


%\section{Speed Comparison}
\begin{figure*}[tb]
  \includegraphics{fig/speedtest.pdf}
  \caption{\label{fig:speedtest}
    The convergence to the transition state as a function of the number of gradient calculations using the BITSS (black line) and string methods for (a) a Lennard-Jones seven-particle cluster, (b) cylindrical shell buckling, and (c) wetting of a chemically-striped surface.
    The string method is repeated with a differing number of images along the string, the number of which is listed in the legend in (c).
    The shown configurations correspond to the two minimum energy states and the transition state, marked by an asterisk.
  }
\end{figure*}
\topic As a result of the BITSS method using only two states it has the potential to be significantly faster than chain-of-states approaches which typically use tens of states.
This is tested here by measuring the speed of convergence to the transition state for BITSS in comparison with the string method and DNEB for several representative examples.

\topic The first system to be tested is a two-dimensional, seven-particle cluster, with the transition from a hexagonal cluster to a higher energy configuration.
The interaction between each pair of particles uses the Lennard-Jones potential,
\begin{equation}
  E = 4\epsilon \left[ \left(\frac{\sigma}{r}\right)^{12} - \left(\frac{\sigma}{r}\right)^6 \right],
\end{equation}
where $r$ is the particle separation, $\epsilon$ is the interaction strength, and $\sigma$ is the particle size.

\topic The second system is an elastic cylindrical shell under an applied strain.
This undergoes a transition from an unbuckled state to a singly-dimpled state, which defines the minimum energy required for the cylinder to buckle \cite{Panter2019}.
A 2D triangular mesh is used to model this system, with the following energy function,
\begin{equation}
  E = \sum_i k^S_i (r_i - r^0_i)^2 + \sum_j k^B_j [1 + \cos(\theta_j - \theta^0_j)].
\end{equation}
The first term provides the stretching energy for the system using a sum over all the bonds, where $r_i$ is the length, $r^0_i$ is the equilibrium length, and $k^S_i$ is the stretching rigidity of bond $i$.
The second term models the bending energy by representing each pair of adjacent triangles as an elastic hinge.
For hinge $j$, $\theta_j$ is the dihedral angle, $\theta^0_j$ is the equilibrium angle, and $k^B_j$ is the bending rigidity.

\topic The final system involves a droplet situated on a chemically striped surface with both hydrophilic and hydrophobic regions.
This has two possible states, with the droplet either upon one hydrophilic stripe, or straddling across two.
This is modelled on a 200x200 2D grid using a phase-field model \cite{Panter2019b}, which has an order parameter, $\phi(\bm{r})$, representing the phase of the liquid ($\phi=-1$ for gas, $\phi=1$ for liquid).
The energy functional has four separate terms,
\begin{equation} \label{eq:phasefield}
  E[\phi] = E_B[\phi] + E_I[\phi] + E_S[\phi] + E_V[\phi].
\end{equation}
The first term, $E_B$, uses a double well potential to set values of $\phi=\pm1$ in the bulk.
The second term then provides the interfacial energy between the liquid and gas by imposing an energy penalty to gradients in $\phi$.
$E_S$ is the solid-liquid interaction energy, which sets the contact angles of the hydrophilic and hydrophobic regions to 60\si{\degree} and 110\si{\degree}, respectively.
Finally, $E_V$ constrains the volume of the liquid drop by penalising any variation from 11\% of the total volume of the system.
For further details and the gradients of the potentials see the supplementary information.

\topic Convergence is measured using the distance from the transition state as a function of number of evaluations to the gradient of the system's potential.
The transition state is compared to the average of the two states for BITSS, whereas for the chain-of-states methods, the closest point on a cubic spline is used.

\topic The results for this test, shown in \cref{fig:speedtest}, demonstrate two main advantages for the BITSS method.
Firstly, the slope illustrates that the rate of convergence is indeed much greater for the BITSS method.
It is matched only by the initial rate of the string method using less than ten images, however these soon slow and are relatively inaccurate.
Secondly, the BITSS method can more accurately approximate the transition state by orders of magnitude, particularly for the wetting example where the string method does not significantly improve upon the initial pathway estimate.
Therefore, unlike the string method, BITSS does not require a second approach to accurately locate the transition state.
Similar results are also found when comparing against against DNEB, which can be seen in the supplementary information.


%\section{Adaptive mesh}
\topic Adaptive remeshing and coarse-graining are widely used techniques that we can utilise to further increase the efficiency of BITSS.
These techniques cause issues for double-ended methods because the coupled states may end up with different discretisations.
However, in BITSS the only direct coupling is in the distance measure, $\mathrm{d}(\bm{x}_1,\bm{x}_2)$, which is relatively easy to adapt.
Here we demonstrate the use of adaptive remeshing by considering two separate issues.

\topic Firstly, we show in \cref{fig:adaptivemesh}a that BITSS is able to handle the discretisation changing as the method runs.
For this we use the cylindrical buckling example with the resolution increasing from 40 to 100 triangles around the cylinder.
These changes are performed after the minimisation step in each iteration of the BITSS method.
This demonstrates that BITSS is able to converge to the transition state so long as the remeshing does not significantly change the landscape.

\topic In the second test, \cref{fig:adaptivemesh}b, we demonstrate the use of different meshes for the two states in the striped wetting example.
In this case, the distance measure is adapted by interpolating one state onto the other mesh and computing the Euclidean distance.
However, for some applications a simpler measure may be sufficient, such as the difference between average values of the system.
Using this approach, BITSS is able to closely approach the transition state.
The convergence precision is now limited by the transition state energy differing slightly on each grid, but this effect is reduced when using an adaptive method or a higher resolution.

\begin{figure}[tb]
  \includegraphics{fig/adaptivemesh.pdf}
  \caption{\label{fig:adaptivemesh}
    (a) Snapshots of the BITSS method applied to the buckling of a cylinder with a changing mesh.
        The radial displacement relative the unbuckled cylinder is shown, as well as the underlying triangular mesh.
    (b) BITSS applied to the striped wetting example with different resolutions for the two states.
        Each grid cell denotes 50x50 lattice nodes.
        The zoomed axes shows the difference in the fluid interface between the two final states, as well as the approximated transition state (solid black line).
        This is compared to the transition state found using a high resolution (dashed line).
  }
\end{figure}


%\section{Zero-curvature modes}
\topic The final challenges we will address are those related to complex landscapes.
The first is the presence of flat regions in the landscape.
\Cref{fig:flatdiscontinuous}a shows BITSS applied to a 2D landscape with two such regions (i \& ii) that are flat in the $x$-direction.
We see BITSS is able to successfully converge past these flat regions, even with one very close to the transition state (ii).
In these regions there are no driving forces due to the potential and the energy constraint, which use purely local information about the gradient.
However, the distance constraint continues to pull the states together, preventing them from getting stuck.
When only a single state has a zero-gradient mode then the other is likely to slide down the potential slightly (iii), but the two states still remain either side of the dividing ridge and so the result is unaffected.

\begin{figure}[tb]
  \includegraphics{fig/flatdiscontinuous.pdf}
  \caption{\label{fig:flatdiscontinuous}
    (a) Energy profile of the BITSS pathway on a 2D potential with flat regions.
        The blue and red dots denote the minima and transition state, respectively.
        Points of interest are labelled by i--iii (see text).
        Top inset: A zoomed in view around the transition state.
        Bottom inset: The pathway taken, with the edges of the flat regions marked by dashed lines.
    (b) Disconnectivity graph of the energy landscape for a seven-particle cluster with a discontinuous hard-core pair potential.
    (c) Plot of the discontinuous potential.
        The repulsive section of the standard Lennard-Jones potential is also shown in grey.
  }
\end{figure}


%\section{Gradient-free problems}
\topic Finally we investigate the application of BITSS to systems with undefined gradients, such as when the landscape is discontinuous.
In this case a couple of alterations to the method must be made.
First, the term using gradients in \cref{eq:kd} can be ignored and $\kappa_d$ can instead be calculated using just the second term.
Next we must use a minimiser that does not require a differentiable optimisation function; for this we use simulated annealing \cite{Kirkpatrick1983}.
This has a chance of randomly jumping one state over the dividing barrier, but we can reduce this probability by setting the initial temperature to $T_0 = \Delta E / 10$, and the maximum size of random displacements to $d_\text{max} = d(\bm{x}_1, \bm{x}_2) / 100$.
This has been tested using a Lennard-Jones 7-particle cluster with hard cores, resulting in a discontinuous landscape.
Using the gradient-free approach, BITSS is able to successfully find the transition states, allowing us to plot the disconnectivity graph of the system, shown in \cref{fig:flatdiscontinuous}b.
A comparison with the results for the standard Lennard-Jones cluster is given in the supplementary information.
It is worth noting, however, that a gradient-based approach is significantly more efficient, and so should be preferred if possible.


%\section{Conclusion}
\topic In conclusion, we have demonstrated a novel method for finding transition states that tackles problems not currently addressed by existing methods.
The method is shown to be more efficient than existing double-ended methods, both in memory and computational cost, with further reductions possible by utilising adaptive remeshing techniques.
It can also be adapted to problems with complex energy landscapes, including those with flat or discontinuous regions.
This method will enable the analysis of energy landscapes for new systems in both particulate and continuum applications, and increase the feasibility of such methods for large-scale, complex systems.


\appendix
\section{}

\begin{acknowledgments}
  S.~J.~A. is supported by a studentship from the Engineering and Physical Sciences Research Council (Grant No. EP/R513039/1).
  H.~K. and J.~R.~P. acknowledge funding from the Engineering and Physical Sciences Research Council (Grant No. EP/V034154/1).
\end{acknowledgments}

\bibliographystyle{apsrev4-2}
\bibliography{bibexport.bib}

\end{document}
