\documentclass[aps,prl,twocolumn,groupedaddress]{revtex4}

% Maths
\usepackage{bm}
\usepackage{amsmath}

% Text
\usepackage{siunitx}

% Figures
\usepackage{graphicx}

% Referencing
\usepackage{cleveref}
\newcommand{\ccite}[1]{ref.~\cite{#1}}
\newcommand{\Ccite}[1]{Ref.~\cite{#1}}
\newcommand{\ccites}[1]{refs.~\cite{#1}}
\newcommand{\Ccites}[1]{Refs.~\cite{#1}}

% Temp
\usepackage{lipsum}
\usepackage{xcolor}
\newcommand{\temp}[1]{{\leavevmode\color{red}#1}}
\newcommand*{\newlinecommand}[2]{%
  \newcommand*{#1}{%
    \begingroup%
    \escapechar=`\\%
    \catcode\endlinechar=\active%
    \csname\string#1\endcsname%
  }%
  \begingroup%
  \escapechar=`\\%
  \lccode`\~=\endlinechar%
  \lowercase{%
    \expandafter\endgroup
    \expandafter\def\csname\string#1\endcsname##1~%
  }{\endgroup#2\space}%
}
\newlinecommand{\topic}{\textbf{#1}}
% \newlinecommand{\topic}{#1}




\begin{document}
\title{Locating saddle points in complex and memory intensive landscapes}
\author{Sam Avis}
\author{Jack Panter}
\author{Halim Kusumaatmaja}
\affiliation{Department of Physics, Durham University, South Road, Durham DH1 3LE, UK}

\begin{abstract}
  Locating transition states is crucial for investigating transition mechanisms in atomistic systems and, more recently, macroscale applications.
  However, these pose certain challenges that are largely unaddressed by existing methods.
  We introduce a new double-ended method, the Binary Image Transition State Search (BITSS), that uses just two states that converge to the transition state, resulting in a faster and more memory-efficient method than current approaches.
  We demonstate it succesfully overcomes challenges associated with large-scale systems and complex energy landscapes.
\end{abstract}

\maketitle


%\section{Introduction \& Method}
\topic Transition states are central to the description of reconfiguration mechanisms for systems in chemistry, condensed matter physics, and engineering.
Historically, many computational methods for locating transition states have grown from an atomistic or particulate perspective.
These have proven to be important tools for understanding, for example, protein folding \cite{Bryngelson1995,Onuchic1997}, biological and industrial catalysis \temp{[cite]}, crystallisation, and cluster formation \cite{Wales1998,Wales2012}.

\topic In addition to these microscale applications it is also increasingly being recognised that transition states are useful in mesoscale or macroscale systems.
Here, the minimum energy barriers provide important lower bounds to the energy input required for transitions to occur.
This is essential to capture in, for example, structural engineering applications, where the minimum energy mechanism for structural failure must be known in order to ensure safety \cite{Panter2019,Hutchinson2018}.
Moreover, it is becoming desirable to tailor elastic deformation transitions to enable technologies such as advanced deployable structures \cite{Filipov2015,Zhai2018}, mechanical sensors and actuators, and energy absorption \cite{Shan2015} to name but a few.
Probing minimum energy transition mechanisms are also essential to the development of super liquid-repellent surfaces \cite{Zhang2014,Panter2019b}, and are even finding applications in robotics in efficient locomotion through complex terrain \cite{Othayoth2020}.

\topic Existing transition state search methods generally fall into two categories, single- and double-ended methods.
Single-ended methods are initialised at a single state and attempt to climb to a nearby saddle point.
Examples include eigenvector following \cite{Cerjan1981}, the dimer method \cite{Heyden2005,Kastner2008}, and climbing image methods \cite{E2007,Ren2013}.
Double-ended methods, such as the string method \cite{E2002,E2007} and doubly-nudged elastic band (DNEB) \cite{Trygubenko2004}, involve initialising a chain of states between two minima and then minimising the total energy of the chain.
In addition to approximating the transition state, these are useful for obtaining an estimate for the full transition pathway.

\topic However, a large range of landscapes prove challenging or impossible to explore via these methods.
One key problem arises from the push towards larger and more complex systems \temp{[cite]}, resulting in the need to develop algorithms that are more memory and computationally efficient, and can incorporate optimisation strategies such as on-the-fly adaptive remeshing and coarse-graining.
However, existing transition state methods exhibit inefficiencies that can make complex systems infeasible.
Single-ended methods are not well suited for identifying specific pathways and can spend a large amount of time searching for undesired transition states.
While, double-ended methods require a chain of tens of states to gain an accurate approximation, and have issues with remeshing resulting in a different discretisation for each state.
Other challenges occur for complex landscapes, such as those that are locally flat or discontinous.
Both of which can be relevent when considering contact forces for macroscopic objects \temp{[cite]}.
Flat landscapes can pose issues for single-ended search methods that rely only upon local information, and most current methods cannot be used for discontinuous landscapes because they typically require continuous, differentiable optimisation functions.

\topic In this work we introduce a new method, the Binary Image Transition State Search (BITSS), and demonstrate how it addresses each of these challenges.
This method combines aspects of the two traditional categories; it is a double-ended method that uses just two states that converge from two local minima towards a transition state that separates them.
The states, $\bm{x}_1$ and $\bm{x}_2$, are first initialised in different basins of attraction of the local minima.
While these can be set to the minima, this is not a necessary requirement.
Upon application of the BITSS method, the two images are brought closer to the ridge separating the basins of attraction, while also minimising the energy of the pair of images.
In this way, the two images meet at the lowest energy point on the ridge - the transition state.
This is demonstrated for a simple 2D potential with two minima in \cref{fig:toy2d}a.

\begin{figure}[htb]
  \includegraphics{fig/toy2d.pdf}
  \caption{\label{fig:toy2d}
    (a) The trajectories of the two states under the BITSS method for a simple 2D potential with two minima (blue dots).
        The transition state is shown by an red dot, and the minimum energy pathway by the dashed line.
    (b) A snapshot of the BITSS minimisation showing the driving forces on each state due to the energy constraint, $\bm{F}_E$, and distance constraint, $\bm{F}_D$, with $E_1 < E_2$ and $d(\bm{x}_1,\bm{x}_2) > d_i$.
    (c) The final configuration of the BITSS method showing the two states in orange, the transition state in red, and the negative curvature eigenvector, $\bm{\hat{\tau}}$.
  }
\end{figure}

\topic Two soft constraints are used to achieve the transition state convergence, while preventing either from passing over the dividing ridge.
The former is implemented by constraining the distance between the states at iteration $i$, and reducing the target separation, $d_i$, from the initial separation, $d_0$, by a constant factor:
\begin{equation}\label{eq:diteration}
  d_{i+1} = (1 - f) d_i.
\end{equation}
We find that a factor of $f = 0.5$ is succesful for most applications, but this can be made smaller to ensure that the states do not slide off the ridge.
The second constraint sets the energies of the two states to be equal.
This ensures neither state can pass over the ridge so long as the distance is not reduced too quickly.
These constraints are implemented using quadratic energy penalty terms, resulting in the following potential for the pair of states,
\begin{multline}\label{eq:bitss}
  E_\text{BITSS}(\bm{x}_1, \bm{x}_2) = E_1 + E_2
    + \kappa_e \left( E_1 - E_2 \right) ^2 \\
    + \kappa_d \left( \mathrm{d}(\bm{x}_1, \bm{x}_2) - d_i \right) ^2,
\end{multline}
where $E_1$ and $E_2$ are the single state energies, and $\mathrm{d}(\bm{x}_1, \bm{x}_2)$ is the measure of distance between the two states.
The energy constraint pushes the state with a higher energy down the potential, and the lower energy state up, while the distance constraint pulls them together if their separation is too great, and pushes them apart if they are too close.
These driving forces are demonstrated for the 2D potential in \cref{fig:toy2d}b.

\topic To locate the transition state without crossing the ridge, the constraint strengths $\kappa_d$ and $\kappa_e$ are updated as the algorithm proceeds.
Consequently, we automate their assignment using information from the system.
They are initially calculated at the start of each minimisation, and regularly recalculated throughout (once per 100 iterations are used in this work).
The coefficients are chosen such that each term in the gradient of \cref{eq:bitss} is of a similar size, providing the following expressions,
\begin{gather}
  \kappa_e = \frac {\alpha} {2 \Delta E},
  \label{eq:ke}
  \\
  \kappa_d = \text{max} \left(
    \frac {\sqrt{|\bm{\nabla} E_1|^2 + |\bm{\nabla} E_2|^2}} {2\sqrt{2} \beta d_i} \; , \;
    \frac{\Delta E}{\beta d_i^2} \right),
  \label{eq:kd}
\end{gather}
where $\alpha$ and $\beta$ are parameters with recommended values of $\alpha = 10$ and $\beta = 0.1$ (see supplementary information).
$\Delta E$ is an estimation for the current energy barrier which is evaluated by linearly interpolating between the two current states.
For systems where the interpolation deviates significantly from the minimum energy pathway this estimate can be much too large.
In which case, a maximum estimated value for the barrier can be provided, which then decreases proportionally with $d_i$.

\topic In summary, the method involves iteratively performing the following three steps:
\begin{enumerate}
  \item Reduce the target separation using \cref{eq:diteration}.
  \item Compute the constraint coefficients using \cref{eq:ke,eq:kd}.
  \item Minimise the potential, \cref{eq:bitss}, and recompute the coefficients every 100 iterations of the minimisation.
\end{enumerate}
Any minimisation algorithm can be used in step three; in this work the L-BFGS algorithm is chosen, owing to its fast convergence and low memory requirement for large numbers of degrees of freedom \cite{Liu1989}.
Finally, the convergence criteria for the method can be based upon either the separation between the states, or the size of gradient at the estimate for the transition state midway between the two states.

% This is here to prevent it being put on the wrong page
\begin{figure*}[tb]
  \includegraphics{fig/speedtest-a.pdf}%
  \includegraphics{fig/speedtest-b.pdf}%
  \includegraphics{fig/speedtest-c.pdf}%
  \caption{\label{fig:speedtest}
    The rate of convergence to the transition state for (a) a Lennard-Jones seven-particle cluster, (b) cylindrical shell buckling, (c) wetting of a chemically-striped surface.
    Above are the two minimum energy states and the transition state, marked by an asterisk.
    Below is shown the convergence to the transition state as a function of the number of gradient calculations using the BITSS (black line) and string methods.
    The string method is repeated with a differing number of images along the string, the number of which is listed in the legend in (c).
  }
\end{figure*}

\topic The typical trajectory of the two states in the BITSS method is shown in \cref{fig:toy2d}a.
Initially, the lower energy state jumps up to satisfy the equal energy constraint and then moves to reduce the separation as much as possible without increasing its energy.
Then, the two states begin to converge directly towards one another, before being deflected in the direction of a saddle in the potential.
Consequently, if there are multiple possible pathways between two states, BITSS will be biased towards identifying pathways that are more direct or with lower energy.
As the two states approach the transition state, the path they take begins to closely follow the minimum energy pathway, which is the path that follows the gradient from the minima and passes through the transition state.
Therefore, the final two states are positioned in the direction of the negative curvature eigenvector, $\bm{\hat{\tau}}$, as shown in \cref{fig:toy2d}c.
In this way, BITSS automatically identifies the 'reactive mode' and associated eigenvalue.

\topic Once BITSS has identified the transition state it is possible to find the full minimum energy pathway.
This is done by tracing the trajectory of downhill minimisations from either side of the transition state, which are provided by the two final states of BITSS.
To ensure this pathway is sufficiently smooth the maximum step size of the minimisation should be restricted.


%\section{Speed Comparison}
\topic As a result of the BITSS method using only two states it has the potential to be significantly faster than chain-of-states approaches which typically use tens of states.
This is tested here by measuring the speed of convergence to the transition state for BITSS in comparison with the string method and DNEB for several representitive examples.
The accuracy of the BITSS method is calculated using the distance between the correct transition state and the average of the two states.
While for the chain-of-states methods, the accuracy is measured as the distance of the transition state from a cubic spline interpolation of the points along the string.
For each method, the accuracy is measured against the number of times the energy and gradient of the system are evaluated.
The results in comparison with the string method are shown in \cref{fig:speedtest}.

\topic The first system to be tested is a two-dimensional seven-particle cluster with Lennard-Jones interactions.
The transition begins with the hexagonal cluster and involves two particles shifting to reach a higher energy configuration.

\topic The second system is an elastic cylindrical shell under an applied strain.
This undergoes a transition from an unbuckled state to a singly-dimpled state, which defines the minimum energy required for the cylinder to buckle \cite{Panter2019}.
A 2D triangular mesh is used to model this system, with the following energy function,
\begin{equation}
  E = \sum_i k^S_i (r_i - r^0_i)^2 + \sum_j k^B_j [1 + \cos(\theta_j - \theta^0_j)].
\end{equation}
The first term provides the stretching energy for the system using a sum over all the bonds, where $r_i$ is the length, $r^0_i$ --- the equilibrium length, and $k^S_i$ --- the stretching rigidity of bond $i$.
The second term models the bending energy by representing each pair of adjacent triangles as an elastic hinge.
For hinge $j$, $\theta_j$ is the dihedral angle, $\theta^0_j$ --- the equilibrium angle, and $k^B_j$ --- the bending rigidity.

\topic The final system involves a droplet situated on a chemically striped surface with both hydrophilic and hydrophobic regions.
This has two possible states, with the droplet either upon one hydrophilic stripe, or straddling across two.
This is modelled on a 200x200 2D grid using a phase-field model \cite{Panter2019b}, which has an order parameter, $\phi(\bm{r})$, representing the phase of the liquid ($\phi=-1$ for gas, $\phi=1$ for liquid).
The energy functional has four separate terms,
\begin{equation} \label{eq:phasefield}
  E[\phi] = E_B[\phi] + E_I[\phi] + E_S[\phi] + E_V[\phi].
\end{equation}
The first term, $E_B$, uses a double well potential to set values of $\phi=\pm1$ in the bulk.
The second term then provides the interfacial energy between the liquid and gas by imposing an energy penalty to gradients in $\phi$.
$E_S$ is the solid-liquid interaction energy, which sets the contact angles of the hydrophilic and hydrophobic regions to 60\si{\degree} and 110\si{\degree}, respectively.
Finally, $E_V$ constrains the volume of the liquid drop by penalising any variation from 11\% of the total volume of the system.

\topic The results for this test, shown in \cref{fig:speedtest}, demonstrate two main advantages for the BITSS method.
Firstly, the slope illustrates that the rate of convergence is indeed much greater for the BITSS method.
It is matched only by the initial rate of the string method using less than ten images, however these soon slow and are relatively inaccurate.
Secondly, the BITSS method can more accurately approximate the transition state by orders of magnitude, particularly for the wetting example where the string method does not significantly improve upon the initial pathway estimate.
Therefore, unlike the string method, BITSS does not require a second approach to accurately locate the transition state.
Similar results are also found when comparing against against DNEB, which can be seen in the supplementary information.


%\section{Adaptive mesh}
\topic To further increase the speed of the method we can use adaptive remeshing and coarse-graining to lower the resolution of the system in regions with few changing features.
However, this introduces additional complexity to the method.
It must be able to handle both the degrees of freedom changing, and the two states having separate discretisations.
Here we test each of these issues individually.

\topic Firstly, we demonstrate in \cref{fig:adaptivemesh}a that BITSS is indeed able to handle the discretisation changing as the method runs.
For this we use the cylindrical buckling example with the resolution increasing from 40 to 100 triangles around the cylinder.
These changes are performed after the minimisation step in each iteration of the BITSS method.
This demonstrates that BITSS is able to converge to the transition state so long as the remeshing is not so drastic that one state is shifted into the basin of another minima.

\topic For the second test, we investigate how BITSS performs when the two states have different meshes.
The only special consideration needed for this is that the distance measure must take into account the different grids.
This is done here by interpolating one state onto the other grid and computing the Euclidean distance.
Although, for some applications it may be sufficient to use simpler distance measures, such as the difference between average values of the system.
The results for the striped wetting example with two different resolutions (shown in \cref{fig:adaptivemesh}b) demonstates that BITSS is successful.
Notably however, there is a limit to how close the two states can get.
This is because the energy of the transition state is slightly different on each grid, so eventually the energy constraint will fail.
Despite this, the two states are still able to get very close and give a very good approximation to the transition state.
Furthermore, using an adaptive grid model the grids would also be expected to converge, thereby eliminating the issue.

\begin{figure}[tb]
  \includegraphics{fig/changingmesh.pdf}\\
  \includegraphics{fig/differentgrids.pdf}
  \caption{\label{fig:adaptivemesh}
    (a) Snapshots of the BITSS method applied to the buckling of a cylinder with a changing mesh.
        The radial displacement relative the unbuckled cylinder is shown, as well as the underlying triangular mesh.
    (b) BITSS applied to the striped wetting example with different resolutions for the two states.
        Each grid cell denotes 50x50 lattice nodes.
        The zoomed axes shows the difference in the fluid interface between the two final states, as well as the approximated transition state (solid black line).
        This is compared to the true transition state found using a high resolution for both states (dashed line).
  }
\end{figure}


%\section{Zero-curvature modes}
\topic Interaction potentials in many particulate and macroscale systems are short-range, and often limited to contact forces.
Thus, there may be many regions in the potential energy landscape that are locally flat.
Single-ended search methods generally only use local information, and so require specialist treatment to deal with these zero modes.
For example, global translation and rotation in free space require analytic expressions for the translation and rotation vectors, which are known \temp{\cite{Wales2004}}.
However, these single-ended search methods are thwarted by local zero modes.

\topic In \cref{fig:flatdiscontinuous}a we demonstrate the BITSS method applied to a 2D potential with regions containing such zero modes (i \& ii).
We see it is able to successfully converge past these flat regions, even with one very close to the transition state (ii).
In these regions there are no driving forces due to the potential and the energy constraint, which use purely local information about the gradient.
However, the distance constraint continues to pull the states together, preventing them from getting stuck.
When only a single state has a zero-gradient mode then the other is likely to slide down the potential slightly, causing a kink in the pathway (iii).
Although, the two states still remain either side of the dividing ridge and so the result will be unaffected.
Indeed, it may only cause BITSS to fail if the zero-gradient mode is positioned at the transition state in the direction of the pathway.
But in this case there is no single transition state, instead the minimum energy pathway would have a flat section at the top of its energy profile.

\begin{figure}[tb]
  \includegraphics{fig/zeroeigen.pdf}\\
  \includegraphics{fig/discontinuous.pdf}
  \caption{\label{fig:flatdiscontinuous}
    (a) Energy profile of the BITSS pathway on a 2D potential with flat regions.
        The minima and transition state are marked by blue and red dots respectively.
        Points of interest are labelled by i-iii.
        Top inset: A zoomed in view around the transition state.
        Bottom inset: The pathway taken, with the edges of the flat regions marked by dashed lines.
    (b) Disconnectivity graph of the energy landscape for a seven-particle cluster with a discontinuous hard-core pair potential.
    (c) Plot of the discontinuous potential.
        The repulsive section of the usual Lennard-Jones potential is also shown in grey.
  }
\end{figure}


%\section{Gradient-free problems}
\topic In many cases contact forces may be chosen to be infinite to prevent overlap of solid bodies.
This results in the energy landscape becoming discontinuous with regions of undefined gradients.
Alternatively, for some systems the potential energy gradients may be prohibitively expensive to compute, or not available.
In both cases, typical landscapes methods that require continuous, differentiable (often twice-differentiable) optimisation functions will not be appropriate.

\topic However, BITSS can be used for these systems with undefined gradients with just a couple of alterations.
First, the term using gradients in \cref{eq:kd} can be ignored and $\kappa_d$ can instead be calculated using just the second term.
Next we must use a minimiser that does not require a differentiable optimisation function; for this we use simulated annealing \cite{Kirkpatrick1983}.
This has a chance of randomly jumping one state over the dividing barrier, but we can reduce this probability by setting the initial temperature to $T_0 = \Delta E / 10$, and the maximum size of random displacements to $d_\text{max} = d(\bm{x}_1, \bm{x}_2) / 100$.

\topic This has been tested using a Lennard-Jones 7-particle cluster with hard cores, resulting in a discontinuous landscape.
Using the gradient-free approach, BITSS is able to successfully find the transition states, allowing us to plot the disconnectivity graph of the system, as shown in \cref{fig:flatdiscontinuous}b.
A comparison with the results for the standard Lennard-Jones cluster is given in the supplementary information.
It is worth noting that gradient-based approaches are significantly more efficient, so these should be preferred if possible.


%\section{Conclusion}
\topic In conclusion, we have demonstrated a novel method for finding transition states that tackles problems not currently addressed by existing methods.
The method is shown to be more efficient than existing double-ended methods, both in memory and combutational cost, with further reductions possible by utilising adaptive remeshing techniques.
It can also be adapted to problems with complex energy landscapes, including those with flat or discontinuous regions.
This method will enable the analysis of energy landscapes for new systems in both particulate and continuum applications, and increase the feasibility of such methods for large-scale, complex systems.


% \bibliographystyle{apsrev4-2}
\bibliography{../../library.bib}

\end{document}
