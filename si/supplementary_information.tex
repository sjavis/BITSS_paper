\documentclass[aps,physrev,10pt]{revtex4-2}

% Maths
\usepackage{bm}
\usepackage{amsmath}
\newcommand{\abs}[1]{\left| #1 \right|}
\newcommand{\grad}{\bm{\nabla}}
\newcommand{\upDelta}{\mathop{}\!\Delta}

% Referencing
\usepackage{cleveref}
\Crefname{figure}{Fig.}{Figs.}
\renewcommand{\theequation}{S\arabic{equation}}
\renewcommand{\thefigure}{S\arabic{figure}}

% Figures
\usepackage{graphicx}
\usepackage{placeins}


\begin{document}
\title{Binary Image Transition State Search \\ Supplementary Information}
\author{Samuel J. Avis}
\author{Jack R. Panter}
\email[]{j.r.panter@durham.ac.uk}
\author{Halim Kusumaatmaja}
\email[]{halim.kusumaatmaja@durham.ac.uk}
\affiliation{Department of Physics, Durham University, South Road, Durham DH1 3LE, UK}
\maketitle

\section{Optimising the constraint coefficients}
The constraint coefficients are chosen to set comparable sizes for each term in the gradient of the BITSS potential,
\begin{equation} \label{eq:gradBITSS}
  \grad E_\text{BITSS} = \sum_{\substack{i=1,2 \\ j\neq i}} \left[ 1 + 2 \kappa_e (E_i - E_j) \right] \grad E_i + 2 \kappa_d (d - d_i) \grad d.
\end{equation}
To obtain the expression for the energy coefficient, $\kappa_e$, we first assume that the separation is fixed, so the distance term can be ignored.
The coefficient $\kappa_e$ must be high enough to prevent one state from being pulled over the ridge, for which the greatest risk occurs when the gradient on one state is much greater than the other, e.g. $\abs{\grad E_2} \gg \abs{\grad E_1}$.
In this case the total gradient is approximated by
\begin{equation}
  \grad E_\text{BITSS} = \left[ 1 - 2 \kappa_e (E_1 - E_2) \right] \grad E_2.
\end{equation}
Therefore, when not at a transition state or a minimum in the landscape ($\abs{\grad E_2} \neq 0$) convergence will occur when the term in the square brackets is zero, resulting in $E_1 - E_2 = 1 / 2 \kappa_e$.
This energy difference should be less than current energy barrier, so we can substitute it with $E_B / \alpha$, where $E_B$ is the energy barrier estimate described in the main paper and $\alpha$ is a constant greater than one.
This leaves us with the expression,
\begin{equation}
  \kappa_e = \frac {\alpha} {2 E_B}.
\end{equation}

The distance coefficient is determined by assuming that the energies are equal and thus the energy constraint can be ignored.
In this case, convergence will occur when $\grad E_1 + \grad E_2 = -2 \kappa_d (d - d_i) \grad d$.
It is then possible to find the value of $\kappa_d$ for which the magnitude of each side of this equation is equal for a desired relative error in the distance, $\beta = (d - d_i) / d_i$,
\begin{equation}
  \kappa_d = \frac {\sqrt{\abs{\grad E_1}^2 + \abs{\grad E_2}^2}} {2 \sqrt{2} \beta d_i}.
\end{equation}
(Note: The gradient of the distance with respect to a single state has a magnitude of 1, thus the magnitude of the gradient for the pair of states is $\abs{\grad d} = \sqrt{1^2+1^2} = \sqrt{2}$.)
To ensure that the coefficient is not too small if the gradient is close to zero, such as when the states are initialised at the minima, a lower bound is set by replacing $\abs{\grad E_1}$ and $\abs{\grad E_2}$ with $2 E_B / d_i$. This gives the expression,
\begin{equation}
  \kappa_d = \mathrm{max} \! \left(
  \frac {\sqrt{\abs{\grad E_1}^2 + \abs{\grad E_2}^2}} {2 \sqrt{2} \beta d_i}, \quad
  \frac{E_B}{\beta d_i^2} \right).
\end{equation}

In practice, when numerically minimising, the states will jump about slightly which can result in large gradients perpendicular to the optimal movement direction.
To reduce this effect, the gradients are projected in the direction of the separation between the two states:
\begin{equation}
  \abs{\grad E_n} \approx \frac {\abs{(\bm{x}_1 - \bm{x}_2) \cdot \grad E_n}} {\abs{\bm{x}_1 - \bm{x}_2}}.
\end{equation}

\begin{figure}[htb]
  \includegraphics{fig/paramtest-a.pdf}%
  \includegraphics{fig/paramtest-b.pdf}%
  \caption{\label{fig:paramtest}
    Speed of convergence of the BITSS method under different choices of parameters for (a) the seven-particle cluster, and (b) cylindrical buckling.
    The speed is given by the number of evaluations of the gradient until the two states are separated by less than a thousandth of the initial separation.
    The combinations that do not converge to the transition state are shown in grey. 
    The chosen parameters are marked by a red star.
  }
\end{figure}

The constant parameters $\alpha$ and $\beta$ still must be chosen.
To this end we have tested different parameter choices using the seven-particle cluster and cylindrical buckling examples, with fractional separation decreases per BITSS step of $f=0.5$ and $f=0.4$, respectively.
\Cref{fig:paramtest} shows which choices lead to convergence and the speed at which this occurs.
The parameters $\alpha = 10$ and $\beta = 0.1$ are chosen for both converging quickly and being situated far from the regions of non-convergence in both test cases.
Hence, this choice is likely to still succeed even if the boudaries of the regions were to shift under different systems.
However, the user is able to choose values optimised for their specific system should they wish.


\section{Test potentials and gradients}
To use L-BFGS minisation the gradients of the optimisation function must be known.
For the BITSS potential this is given by \cref{eq:gradBITSS}, but this also requires the gradients of the system under consideration.

\subsection{Particle cluster}
For the Lennard-Jones particle cluster the gradient of the potential is found by considering the gradient of the interaction between each pair of particles,
\begin{equation}
  \frac{\partial E}{\partial \bm{x}_1} = -\frac{\partial E}{\partial \bm{x}_2} = - \frac{24 \epsilon}{r^2}
    \left[ 2 \left(\frac{\sigma}{r}\right)^{12} - \left(\frac{\sigma}{r}\right)^6 \right] (\bm{x}_1 - \bm{x}_2),
\end{equation}
where $\bm{x}_1$ and $\bm{x}_2$ are the positions of the two particles, $r$ is their separation, $\epsilon$ is the interaction strength, and $\sigma$ is the particle radius.

\subsection{Cylindrical buckling}
\begin{figure}[htb]
  \includegraphics{fig/BAHschematic.pdf}
  \caption{\label{fig:BAHschematic}
    Schematic of the bar and hinge model showing the relevent parameters for a single hinge element. $h_i$ and $\bm{\hat{n}}_i$ denote the height and unit normal of each triangle respectively.
  }
\end{figure}
For the cylindrical buckling example we can obtain the gradient by considering each bond and hinge individually.
Using the variables shown in the schematic in \cref{fig:BAHschematic}, the gradient of the stretching energy of the bond between $\bm{x}_2$ and $\bm{x}_3$, with equilibrium length $r^0$ and stretching rigidity $k^S$, is given by,
\begin{equation}
  \frac{\partial E^S}{\partial \bm{x}_2} = - \frac{\partial E^S}{\partial \bm{x}_3} = 
    2 k^S (r - r^0) (\bm{x_2} - \bm{x_3}).
\end{equation}
The gradients of the bending energy of the hinge, with equilibium angle $\theta^0$ and bending rigidity $k^B$, are,
\begin{align}
  \frac{\partial E^B}{\partial \bm{x}_1} &= k^B \sin(\theta - \theta^0) \frac{\bm{\hat{n}}_a}{h_a}, \\
  \frac{\partial E^B}{\partial \bm{x}_2} &= - k^B \sin(\theta - \theta^0) \left[\frac{\bm{\hat{n}}_a}{h_a} + \frac{\bm{\hat{n}}_a + \bm{\hat{n}}_b}{r}\right], \\
  \frac{\partial E^B}{\partial \bm{x}_3} &= - k^B \sin(\theta - \theta^0) \left[\frac{\bm{\hat{n}}_b}{h_b} + \frac{\bm{\hat{n}}_a + \bm{\hat{n}}_b}{r}\right], \\
  \frac{\partial E^B}{\partial \bm{x}_4} &= k^B \sin(\theta - \theta^0) \frac{\bm{\hat{n}}_b}{h_b}.
\end{align}

\subsection{Striped wetting}
The four sections of the phase-field model detailed in \namecref{eq:gradBITSS}~(7) are obtained using the following equations,
\begin{align}
  E^B[\phi] &= \sum_i \frac{1}{\epsilon} \left( \frac{{\phi_i}^4}{4} - \frac{{\phi_i}^2}{2} + \frac{1}{4} \right) \upDelta V,\\
  E^I[\phi] &= \sum_i \frac{\epsilon}{2} \abs{\grad \phi_i}^2 \upDelta V,\\
  E^S[\phi] &= \sum_j \sqrt{2}\cos\theta_j \left( \frac{{\phi_j}^3}{6} - \frac{\phi_j}{2} - \frac{1}{3} \right) \upDelta S,\\
  E^V[\phi] &= k_V \left[ \sum_i \frac{\phi_i + 1}{2} \upDelta V - V_0 \right]^2,
\end{align}
where the index $i$ includes all of the nodes, while $j$ represents the nodes along the solid surface.
$\upDelta V$ and $\upDelta S$ are, respectively, the volume and solid surface areas contained by each individual node.
$\epsilon$ is the liquid-gas interface width, $\theta_j$ is the contact-angle with the solid surface, and $V_0$ is the constrained volume of the liquid drop.
The strength of the volume constraint is parametrised by $k_V$ for which we use a value of $10^4$.
The gradients of these terms are given by,
\begin{align}
  \frac{\partial E^B}{\partial \phi_i} &= \frac{1}{\epsilon} \left( {\phi_i}^3 - \phi_i \right) \upDelta V,\\
  \frac{\partial E^I}{\partial \phi_i} &= \frac{\epsilon}{2} \left[
    \frac{\partial \abs{\grad \phi_i}^2}{\partial \phi_i} +
    \sum_k\frac{\partial \abs{\grad \phi_k}^2}{\partial \phi_i} \right] \upDelta V,\\
  \frac{\partial E^S}{\partial \phi_j} &= \sqrt{2}\cos\theta_j \left( \frac{{\phi_j}^2}{2} - \frac{1}{2} \right) \upDelta S,\\
  \frac{\partial E^V}{\partial \phi_i} &= k_V \left[ \sum_{i'} \frac{\phi_{i'} + 1}{2} \upDelta V - V_0 \right] \upDelta V,
\end{align}
where index $k$ denotes neighboring nodes at which the evaluation of the gradient uses $\phi_i$.


\newpage
\section{Details for the adaptive discretisation tests}
Here we provide the details for the interpolations and mapping involved in the two examples demonstrating the feasibility of using an adaptive discretisation method.
For the cylindrical buckling example with a changing mesh, the resolution is refined each time the separation between the two states is halved. 
This involves the number of triangles around the circumference of the cylinder increasing along the sequence, $40 \rightarrow 60 \rightarrow 80 \rightarrow 100$.
The positions of the nodes on the new grid, $\{\bm{n}_i\}$, are determined by linear interpolation from the previous grid $\{\bm{p}_i\}$, using the positions of the unbuckled meshes, $\{\bm{n'}_i\}$ and $\{\bm{p'}_i\}$.
For each node of the new grid, $\bm{n'}_i$, the triangle that contains it is first identified, which we will denote $\{\bm{p'}_1,\bm{p'}_2,\bm{p'}_3\}$, and the barycentric coordinates of the point are computed, $\{\lambda_1,\lambda_2,\lambda_3\}$.
The new position is then given by $\bm{n}_i = \lambda_1 \bm{p}_1 + \lambda_2 \bm{p}_2 + \lambda_3 \bm{p}_3$.

In the example with different resolutions for the two states, the distance is obtained by first mapping the phase field from the higher resolution grid, $\{\phi_{k,l} | k,l \in \{0,1,\cdots,399\}\}$, to the low resolution grid, $\{\phi'_{i,j} | i,j \in \{0,1,\cdots,199\}\}$.
Because a square grid is used with a resolution ratio of two, the mapping involves averaging each 2x2 block to a single point:
\begin{equation}
  \phi'_{i,j} = \frac{1}{4} \left( \phi_{2i,2j} + \phi_{2i+1,2j} + \phi_{2i,2j+1} + \phi_{2i+1,2j+1} \right)
\end{equation}
Then the separation from the other state, $\{\widetilde{\phi}_{i,j}\}$ is computed using the 2-norm,
\begin{equation}
  d = \sqrt{\sum_{i,j} \left( \phi'_{i,j} - \widetilde{\phi}_{i,j} \right)^2}.
\end{equation}
Finally, the gradient of the distance with respect to each point must be mapped back to the higher-resolution grid, which is done by assigning a quarter of each component back to its the original four points:
\begin{equation}
  \frac{\partial d}{\partial \phi_{k,l}} =
    \frac{\partial \phi'_{i,j}}{\partial \phi_{k,l}} \frac{\partial d}{\partial \phi'_{i,j}} =
    \frac{1}{4} \frac{\partial d}{\partial \phi'_{i,j}} =
    \frac{1}{4} \frac{\phi'_{i,j} - \widetilde{\phi}_{i,j}}{d},
\end{equation}
where $k \in \{2i, 2i+1\}$, and $l \in \{2j, 2j+1\}$.


\newpage
\section{Additional results: DNEB speed comparison}
\Cref{fig:DNEBspeedtest} shows the results for the speed test in comparison with DNEB.
Similar to the results for the string method, the slope of BITSS is greater than DNEB with 10 or 20 states, indicating a faster convergence.
Furthermore, with the exception of the seven-particle cluster, DNEB is also much less accurate at approximating the transition state, even with a large number of images.
So it will require a secondary method to accurately locate the transition state, while BITSS does not.

\begin{figure}[htb]
  \includegraphics{fig/DNEBspeedtest.pdf}
  \caption{\label{fig:DNEBspeedtest}
    The convergence to the transition state as a function of the number of gradient calculations using the BITSS (black line) and DNEB for (a) a Lennard-Jones seven-particle cluster, (b) cylindrical shell buckling, and (c) wetting of a chemically-striped surface.
    DNEB is repeated with a differing number of images along the chain, the number of which is listed in the legend in (c).
    The shown configurations correspond to the two minimum energy states and the transition state, marked by an asterisk.
  }
\end{figure}


\section{Additional results: Seven-particle cluster comparison}
\Cref{fig:clusterdgraphs} shows the comparison between the energies of the minima and transition states for the seven-particle cluster.
Notably the energies of the minima are largely unchanged, but the energies of the transition states are found to be slightly higher when using the discontinuous potential.
This indicates that the particles in the Lennard-Jones cluster cut the corner slightly as they transition, whereas this is not possible using the discontinuous potential, resulting in higher energies.

\begin{figure}[htb]
  \includegraphics{fig/clusterdgraphs.pdf}
  \caption{\label{fig:clusterdgraphs}
    Differences in the disconnectivity graphs for the seven-particle cluster when using the discontinuous potential instead of the standard Lennard-Jones potential.
    The two graphs are horizontally offset for visibility.
  }
\end{figure}


\end{document}
